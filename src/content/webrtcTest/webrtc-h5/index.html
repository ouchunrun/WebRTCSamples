<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WebRTC 测试页</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>
<div class="nrtc-container">
    <div class="top">
        <!--    Part1: 测试环境    -->
        <div class="block">
            <p class="block-header">WebRtc 测试环境</p>
            <div id="part-env" class="part">
                <div class="line">
                    <span>操作系统：</span>
                    <span>Windows</span>
                    <div class="line" id="wechatBrowserBox">
                        <!--    安卓微信等环境时才显示该配置项    -->
                        <span>安卓微信内嵌浏览器内核:</span>
                        <span id="wechatBrowser">Chrome （>安卓微信等内嵌浏览器访问时记录内核）</span>
                    </div>
                </div>
                <div class="line">
                    <span>浏览器：</span>
                    <span>Chrome/96.0.4664.110</span>
                </div>
                <div class="line">
                    <span>UA：</span>
                    <span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36</span>
                </div>
                <div class="line">
                    <span>屏幕分辨率：</span>
                    <span>1920 x 1080</span>
                </div>
            </div>

            <p class="block-header">调试</p>
            <div class="part">
                <div class="line">
                    <button type="button" id="toggleVConsole">打开vconsole</button>
                </div>

                <div class="line">
                    <button type="button" id="exportLog">导出测试结果</button>
                </div>

                <div class="line">
                    <button type="button" id="expand">展开/收起所有测试项</button>
                </div>
            </div>

            <p class="block-header">颜色标识说明</p>
            <div class="part">
                <div class="color-identification all-pass">测试项全部通过</div>
            </div>
            <div class="part">
                <div class="color-identification partially-pass">测试项部分通过</div>
            </div>
            <div class="part">
                <div class="color-identification all-fail">测试项全部失败</div>
            </div>
        </div>

        <!--    Part2: webRTC 相关接口    -->
        <div class="block">
            <p class="block-header">设备权限</p>
            <div class="part">
                <div class="line">
                    <span>是否允许使用摄像头:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>是否允许使用麦克风:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">RTCPeerConnection API</p>
            <div class="part" style="display: none">
                <div class="line">
                    <span>RTCPeerConnection():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createOffer():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createAnswer():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createDataChannel():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getReceivers():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getTransceivers():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getSenders():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getStats():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>removeTrack():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>restartIce():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>setLocalDescription():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>setRemoteDescription():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>addTrack():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>close():</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">RTCPeerConnection Event</p>
            <div class="part">
                <div class="line">
                    <span>connectionstatechange:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>icecandidate:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>iceconnectionstatechange :</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>icegatheringstatechange :</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>signalingstatechange :</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>negotiationneeded :</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">RTCRtpSender</p>
            <div class="part">
                <div class="line">
                    <span>replaceTrack():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getParameters():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>setParameters() :</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getStats() :</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getCapabilities()  :</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">MediaDevices.enumerateDevices</p>
            <div class="part">
                <div class="line">
                    <span>enumerateDevices获取设备列表:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>ondevicechange 事件:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>Audio input：</span>
                    <div class="line">
                        <ul>
                            <li>默认 - 耳机式麦克风 (3- Grandstream GUV3000) (2bab:0023)</li>
                            <li>通讯 - 耳机式麦克风 (3- Grandstream GUV3000) (2bab:0023)</li>
                        </ul>
                    </div>
                </div>
                <div class="line">
                    <span>Audio output：</span>
                    <div class="line">
                        <ul>
                            <li>默认 - 扬声器 (Realtek High Definition Audio)</li>
                            <li>通讯 - 头戴式耳机 (3- Grandstream GUV3000) (2bab:0023)</li>
                        </ul>
                    </div>
                </div>
                <div class="line">
                    <span>Video input:</span>
                    <div class="line">
                        <ul>
                            <li>GRANDSTREAM GUV3100 (2bab:0011)</li>
                            <li>Aoni HD Camera (1bcf:2283)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <p class="block-header">MediaDevices.getDisplayMedia</p>
            <div class="part">
                <div class="line">
                    <span>支持的最大分辨率:</span>
                    <span>1920*1080</span>
                </div>
                <div class="line">
                    <span>支持的帧率：</span>
                    <div class="line">
                        <span>5fps:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>15fps:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>30fps:</span>
                        <span class="support"></span>
                    </div>
                </div>
            </div>

            <p class="block-header">MediaDevices.getUserMedia</p>
            <div class="part">
                <div class="line">
                    <span>支持的限制参数:</span>
                    <div class="line">
                        <span>max:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>ideal:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>exact:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>【Camera1】GRANDSTREAM GUV3100 支持的分辨率和帧率:</span>
                    <div class="line">
                        <span>3840 * 2160 * frameRate:30:</span>
                        <span class="notSupport"></span>
                    </div>
                    <div class="line">
                        <span>1920 * 1080 * frameRate:30:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>640 * 360 * frameRate:15:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>【Camera2】Aoni HD Camera 支持的分辨率和帧率:</span>
                    <div class="line">
                        <span>3840 * 2160 * frameRate:30:</span>
                        <span class="notSupport"></span>
                    </div>
                    <div class="line">
                        <span>1920 * 1080 * frameRate:30:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>640 * 360 * frameRate:15:</span>
                        <span class="support"></span>
                    </div>
                </div>
            </div>

            <p class="block-header">MediaStream</p>
            <div class="part">
                <div class="line">
                    <span>addTrack():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>removeTrack():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getTracks():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getAudioTracks():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getVideoTracks():</span>
                    <span class="support"></span>
                </div>

                <div class="line">
                    <span>onaddtrack:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>onremovetrack:</span>
                    <span class="support"></span>
                </div>
            </div>


            <p class="block-header">MediaStreamTrack</p>
            <div class="part">
                <div class="line">
                    <span>applyConstraints():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getConstraints():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getCapabilities():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getSettings():</span>
                    <span class="support"></span>
                </div>
            </div>
        </div>


        <!--    Part3: 其他相关功能    -->
        <div class="block">
            <p class="block-header">音视频编解码列表</p>
            <div class="part">
                <div class="line">
                    <span>音频编码:</span>
                    <div class="line">
                        <span>opus:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>ISAC:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>G722:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>PCMU:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>PCMA:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>DTMF:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RED:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>telephone-event:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>音频解码:</span>
                    <div class="line">
                        <span>opus:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>ISAC:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>G722:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>PCMU:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>PCMA:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>DTMF:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RED:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>telephone-event:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>视频编码:</span>
                    <div class="line">
                        <span>VP8:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>VP9:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>H264:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>H265:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>AV1:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>flexfec-03:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>视频解码:</span>
                    <div class="line">
                        <span>VP8:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>VP9:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>H264:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>H265:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>AV1:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>flexfec-03:</span>
                        <span class="support"></span>
                    </div>
                </div>
            </div>

            <p class="block-header">弱网对抗</p>
            <div class="part">
                <div class="line">
                    <span>音频:</span>
                    <div class="line">
                        <span>FEC:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RED:</span>
                        <span class="support"></span>
                    </div>
                </div>
                <div class="line">
                    <span>视频:</span>
                    <div class="line">
                        <span>FEC:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RED:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RTCP:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>RTX:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>NACK:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>PLI:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>FIR:</span>
                        <span class="support"></span>
                    </div>
                    <div class="line">
                        <span>REMB:</span>
                        <span class="support"></span>
                    </div>
                </div>
            </div>
            <p class="block-header">webSocket </p>
            <div class="part">
                <div class="line">
                    <span>webSocket功能:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>webSocket重连:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>webSocket保活:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">WebAssembly</p>
            <div class="part">
                <div class="line">
                    <span>bigInt():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>bulkMemory():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>exceptions():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>multiValue():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>mutableGlobals():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>referenceTypes():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>saturatedFloatToInt():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>signExtensions():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>simd():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>memory64():</span>
                    <span class="notSupport"></span>
                </div>
                <div class="line">
                    <span>tailCall():</span>
                    <span class="notSupport"></span>
                </div>
                <div class="line">
                    <span>threads():</span>
                    <span class="notSupport"></span>
                </div>
            </div>

            <p class="block-header">captureStream</p>
            <div class="part">
                <div class="line">
                    <span>CanvasElement.captureStream():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>MediaElement.captureStream():</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">WebAudio</p>
            <div class="part">
                <div class="line">
                    <span>createMediaStreamDestination():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createMediaStreamSource():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createMediaElementSource():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>resume():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>createScriptProcessor():</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">MediaRecorder</p>
            <div class="part">
                <div class="line">
                    <span>video/webm\;codecs=vp8:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>video/webm\;codecs=h264:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>audio/webm\;codecs=opus:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>audio/webm:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">WebCodecs</p>
            <div class="part">
                <div class="line">
                    <span>AudioData():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>AudioDecoder():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>AudioEncoder():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>VideoDecoder():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>VideoEncoder():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>ImageDecoder():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>VideoFrame():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>ImageTrack():</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">本地存储</p>
            <div class="part">
                <div class="line">
                    <span>localStorage:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>sessionStorage:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">IndexedDB</p>
            <div class="part">
                <div class="line">
                    <span>open():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>openCursor():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>count():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>getAll():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>bound():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>upperBound():</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>lowerBound():</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">其他</p>
            <div class="part">
                <div class="line">
                    <span>WebTransport:</span>
                    <span class="support"></span>
                </div>

                <div class="line">
                    <span>Web Worker:</span>
                    <span class="support"></span>
                </div>

                <div class="line">
                    <span>CryptoJS加解密:</span>
                    <span class="support"></span>
                </div>
            </div>
        </div>

        <!--    Part4: 功能支持预览    -->
        <div class="block">
            <p class="block-header"> 总体功能支持情况 </p>
            <div class="part">
                <div class="line">
                    <span>P2P音频通话:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>P2P视频通话:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>开摄像头:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>关摄像头:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>开演示:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>开启桌面共享:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>关闭桌面共享:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>获取音视频设备列表:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>webSocket断网重连:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>webSocket保活:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>ICE重连:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>Trickle-ice:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>WebHID:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>debug.js日志导出:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>噪音检测:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>音量检测:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>切换前后摄像头（移动端）:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header"> getStats 状态统计 </p>
            <div class="part">
                <div class="line">
                    <span>网络延迟:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>网络抖动:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>提名的candidatePair:</span>
                    <span class="support"></span>
                </div>
                <div class="line">
                    <span>判断使用UDP or TCP:</span>
                    <span class="support"></span>
                </div>
            </div>

            <p class="block-header">以下测试项请手动选择</p>
            <div class="part">
                <div class="line">
                    <span>MIC和摄像头系统授权提示方式:</span>
                    <select>
                        <option value=''>自动授权</option>
                        <option value=''>不提示授权</option>
                        <option value=''>左上角弹框或页面弹框</option>
                    </select>
                </div>
                <div class="line">
                    <span>每次访问MIC和摄像头都独立授权:</span>
                    <label><input type="checkbox">是</label>
                </div>
                <div class="line">
                    <span>共享时可选择整个屏幕、窗口或某个tab页:</span>
                    <label><input type="checkbox">支持</label>
                </div>
                <div class="line">
                    <span>共享整个屏幕时选择多屏幕:</span>
                    <label><input type="checkbox">支持</label>
                </div>
                <div class="line">
                    <span>共享桌面时共享音频:</span>
                    <label><input type="checkbox">支持</label>
                </div>
                <div class="line">
                    <span>本地虚拟背景设置:</span>
                    <label><input type="checkbox">支持</label>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="application/javascript" src="js/vconsole.min.js"></script>
<script>
    let vconsole = null
    document.getElementById('toggleVConsole').onclick = function (){
        if (!vconsole){
            vconsole = new VConsole();
        }
    }

    let blockHeaders = document.getElementsByClassName('block-header')
    document.getElementById('expand').onclick = function (){
        if(!blockHeaders){
            blockHeaders = document.getElementsByClassName('block-header')
        }
        if(blockHeaders && blockHeaders.length){
            for (let i = 3; i<blockHeaders.length; i++){
                let blockHeader = blockHeaders[i]
                if(blockHeader.nextElementSibling){
                    if(blockHeader.nextElementSibling.style.display !== 'none'){
                        blockHeader.nextElementSibling.style.display = 'none'
                    }else {
                        blockHeader.nextElementSibling.style.display = ''
                    }
                }
            }
        }
    }


    if(blockHeaders && blockHeaders.length){
        for (let i = 0; i<blockHeaders.length; i++){
            let blockHeader = blockHeaders[i]
            blockHeader.onclick = function (){
                if(blockHeader.nextElementSibling){
                    if(blockHeader.nextElementSibling.style.display !== 'none'){
                        blockHeader.nextElementSibling.style.display = 'none'
                    }else {
                        blockHeader.nextElementSibling.style.display = ''
                    }
                }
            }
        }
    }

    function setBlockHeadersDisplay(displayStyle){
        if(!blockHeaders){
            blockHeaders = document.getElementsByClassName('block-header')
        }
        if(blockHeaders && blockHeaders.length){
            for (let i = 3; i<blockHeaders.length; i++){
                let blockHeader = blockHeaders[i]
                if(blockHeader.nextElementSibling){
                    blockHeader.nextElementSibling.style.display = displayStyle
                }
            }
        }
    }

    window.onload = function (){
        console.log('收起所有展开项')
        setBlockHeadersDisplay('none')
    }
</script>
</body>
</html>